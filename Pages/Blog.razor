@page "/blog"
@using System.Net.Http
@using Markdig
@using MyPortfolio.Services
@using MyPortfolio.Components.BlogPost

@inject ContentService ContentService

<PageTitle>My Adventures</PageTitle>

<CascadingValue Value="currentPalette">
    <MudContainer>
        <MudGrid>
            <MudItem sm="12" md="6">
                <MudText Typo="Typo.h4" class="mt-5" Color="Color.Secondary">My Adventures</MudText>
                @if (truncatedContent.Count == 0)
                {
                    <MudProgressCircular Class="mt-5" Color="Color.Primary" Indeterminate="true" />
                }
                else
                {
                    @foreach (var item in truncatedContent)
                    {
                        <BlogpostTeaser TeaserContent="@(new MarkupString(Markdown.ToHtml(item)))" />
                    }
                }
            </MudItem>
        </MudGrid>
    </MudContainer>
</CascadingValue>

@code {
    [CascadingParameter]
    public Palette? currentPalette { get; set; }
    private List<ContentService.GitHubFile> GitHubFiles = new List<ContentService.GitHubFile>();
    private List<string> truncatedContent = new List<string>();
    private string errorMessage = "Loading...";
    protected override async Task OnInitializedAsync()
    {
        try
        {
            GitHubFiles = await ContentService.LoadContentAsync();

            foreach (var file in GitHubFiles)
            {
                Console.WriteLine(file.Content);
                Console.WriteLine(file.Name);
                Console.WriteLine(file.Url);
                Console.WriteLine(file.CommitDate);
                Console.WriteLine(file.Committer);
            }

        }
        catch (Exception ex)
        {
            errorMessage = ex.Message;
        }

    }

    public string TruncateText(string text, int length)
    {
        var words = text.Split(' ');
        if (words.Length > length)
        {
            return string.Join(" ", words.Take(length)) + "...";
        }
        else
        {
            return text;
        }
    }
}
